<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `spirit_log` crate."><meta name="keywords" content="rust, rustlang, rust-lang, spirit_log"><title>spirit_log - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../spirit_log/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate spirit_log</p><div class='block version'><p>Version 0.4.1</p></div><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all spirit_log's items</p></a><div class="block items"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'spirit_log', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/spirit_log/lib.rs.html#1-927' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>spirit_log</a></span></h1><div class='docblock'><p>A <a href="../spirit/index.html" title="spirit"><code>spirit</code></a> fragments and helpers to configure and control logging.</p>
<p>The <a href="../spirit/fragment/trait.Fragment.html" title="Fragment"><code>Fragment</code></a>s here allow to configure relatively complex logging (multiple loggers,
different formats, different destinations), both from command line and the configuration. It
allows runtime reloading of them.</p>
<p>Internally it is based on the <a href="../fern/index.html" title="fern"><code>fern</code></a> crate and just adds the configuration and runtime
reloading (through <a href="https://docs.rs/log-reroute"><code>log-reroute</code></a>).</p>
<p>It assumes the application doesn't set the global logger itself. It also sets the panic hook
through the <a href="https://docs.rs/log_panics"><code>log_panics</code></a> crate. The <code>with-backtrace</code> cargo feature is propagated through.</p>
<h1 id="features" class="section-header"><a href="#features">Features</a></h1>
<ul>
<li><code>background</code>: Includes the ability to log asynchronously ‒ the writing to log files happens
in a background thread and allows the rest of the application to not block on IO.</li>
<li><code>cfg-help</code>: Support for configuration options help at runtime. On by default.</li>
<li><code>with-backtrace</code>: The <a href="https://docs.rs/log_panics"><code>log_panics</code></a> logs with backtraces. On by default.</li>
<li><code>syslog</code>: Adds the support for logging into syslog.</li>
</ul>
<h1 id="startup" class="section-header"><a href="#startup">Startup</a></h1>
<p>When using the automatic management with a pipeline, this is how a startup happens:</p>
<ul>
<li>As soon as the pipeline is registered, a logging on the <code>WARN</code> level is sent to <code>stderr</code>.</li>
<li>After command line arguments are parsed the <code>stderr</code> logging is updated to reflect that (or
left on the <code>WARN</code> level if nothing is set by the user).</li>
<li>After configuration is loaded from the files, full logging is configured according to that.</li>
</ul>
<h1 id="integration-with-other-loggers" class="section-header"><a href="#integration-with-other-loggers">Integration with other loggers</a></h1>
<p>If you need something specific (for example <a href="https://crates.io/crates/sentry"><code>sentry</code></a>), you
can plug in additional loggers through the pipeline ‒ the <a href="../fern/builders/struct.Dispatch.html" title="Dispatch"><code>Dispatch</code></a> allows adding arbitrary
loggers. The <a href="../spirit/fragment/pipeline/struct.Pipeline.html#method.map" title="spirit::fragment::pipeline::Pipeline::map"><code>Pipeline::map</code></a> is a good place to do
it.</p>
<h1 id="performance-warning" class="section-header"><a href="#performance-warning">Performance warning</a></h1>
<p>This allows the user to create arbitrary number of loggers. Furthermore, the logging is
synchronous  by default and not buffered. When writing a lot of logs or sending them over the
network, this could become a bottleneck.</p>
<h1 id="background-logging" class="section-header"><a href="#background-logging">Background logging</a></h1>
<p>The <code>background</code> feature flag adds the ability to do the actual logging in a background thread.
This allows not blocking the actual application by IO or other expensive operations.</p>
<p>On the other hand, if the application crashes, some logs may be lost (or, depending on setup,
when the logging thread doesn't keep up). Also, you need to flush the logger on shutdown, by
using the <a href="../spirit_log/background/struct.FlushGuard.html" title="FlushGuard"><code>FlushGuard</code></a>.</p>
<p>It is done through the <a href="../spirit_log/background/struct.Background.html" title="Background"><code>Background</code></a> transformation.</p>
<h1 id="planned-features" class="section-header"><a href="#planned-features">Planned features</a></h1>
<p>These pieces are planned some time in future, but haven't happened yet (pull requests are
welcome).</p>
<ul>
<li>Reconnecting to the remote server if a TCP connection is lost.</li>
<li>Log file rotation.</li>
<li>Colors on <code>stdout</code>/<code>stderr</code>.</li>
</ul>
<h1 id="usage-without-pipelines" class="section-header"><a href="#usage-without-pipelines">Usage without Pipelines</a></h1>
<p>It is possible to use without the <a href="../spirit/fragment/pipeline/struct.Pipeline.html" title="spirit::Pipeline"><code>Pipeline</code></a>, manually. However,
certain care needs to be taken to initialize everything that needs to be initialized.</p>
<p>It is either possible to just get the <a href="../fern/builders/struct.Dispatch.html" title="Dispatch"><code>Dispatch</code></a> object and call <a href="../fern/builders/struct.Dispatch.html#method.apply" title="Dispatch::apply"><code>apply</code></a>,
that however is a single-shot initialization and the logger can't be replaced.</p>
<p>The helper functions <a href="../spirit_log/fn.init.html" title="init"><code>init</code></a> and <a href="../spirit_log/fn.install.html" title="install"><code>install</code></a> can be used to gain the ability to replace
<a href="../fern/builders/struct.Dispatch.html" title="Dispatch"><code>Dispatch</code></a> loggers multiple times.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1><h2 id="manual-single-use-installation" class="section-header"><a href="#manual-single-use-installation">Manual single use installation</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">AnyError</span>;
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">spirit_log</span>::<span class="ident">Cfg</span>;

<span class="comment">// Well, you&#39;d get it somewhere from configuration, but…</span>
<span class="kw">let</span> <span class="ident">cfg</span> <span class="op">=</span> <span class="ident">Cfg</span>::<span class="ident">default</span>();
<span class="kw">let</span> <span class="ident">logger</span> <span class="op">=</span> <span class="ident">cfg</span>.<span class="ident">create</span>(<span class="string">&quot;logger&quot;</span>)<span class="question-mark">?</span>;
<span class="ident">logger</span>.<span class="ident">apply</span>()<span class="question-mark">?</span>;</pre></div>
<h2 id="manual-multiple-use-installation" class="section-header"><a href="#manual-multiple-use-installation">Manual multiple-use installation</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">AnyError</span>;
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">spirit_log</span>::<span class="ident">Cfg</span>;

<span class="ident">spirit_log</span>::<span class="ident">init</span>();
<span class="comment">// This part can be done multiple times.</span>
<span class="kw">let</span> <span class="ident">cfg</span> <span class="op">=</span> <span class="ident">Cfg</span>::<span class="ident">default</span>();
<span class="kw">let</span> <span class="ident">logger</span> <span class="op">=</span> <span class="ident">cfg</span>.<span class="ident">create</span>(<span class="string">&quot;logger&quot;</span>)<span class="question-mark">?</span>;
<span class="ident">spirit_log</span>::<span class="ident">install</span>(<span class="ident">logger</span>);</pre></div>
<h2 id="automatic-usage-with-a-pipeline-reloading-and-command-line-options" class="section-header"><a href="#automatic-usage-with-a-pipeline-reloading-and-command-line-options">Automatic usage with a Pipeline, reloading and command line options</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">log</span>::<span class="ident">info</span>;
<span class="kw">use</span> <span class="ident">serde</span>::<span class="ident">Deserialize</span>;
<span class="kw">use</span> <span class="ident">spirit</span>::{<span class="ident">Pipeline</span>, <span class="ident">Spirit</span>};
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;
<span class="kw">use</span> <span class="ident">spirit_log</span>::{<span class="ident">Cfg</span> <span class="kw">as</span> <span class="ident">LogCfg</span>, <span class="ident">CfgAndOpts</span> <span class="kw">as</span> <span class="ident">LogBoth</span>, <span class="ident">Opts</span> <span class="kw">as</span> <span class="ident">LogOpts</span>};
<span class="kw">use</span> <span class="ident">structopt</span>::<span class="ident">StructOpt</span>;

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">StructOpt</span>)]</span>
<span class="kw">struct</span> <span class="ident">Opts</span> {
    <span class="attribute">#[<span class="ident">structopt</span>(<span class="ident">flatten</span>)]</span>
    <span class="ident">logging</span>: <span class="ident">LogOpts</span>,
}

<span class="kw">impl</span> <span class="ident">Opts</span> {
    <span class="kw">fn</span> <span class="ident">logging</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">LogOpts</span> {
        <span class="self">self</span>.<span class="ident">logging</span>.<span class="ident">clone</span>()
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>, <span class="ident">Deserialize</span>)]</span>
<span class="kw">struct</span> <span class="ident">Cfg</span> {
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>, <span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;LogCfg::is_empty&quot;</span>)]</span>
    <span class="ident">logging</span>: <span class="ident">LogCfg</span>,
}

<span class="kw">impl</span> <span class="ident">Cfg</span> {
    <span class="kw">fn</span> <span class="ident">logging</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">LogCfg</span> {
        <span class="self">self</span>.<span class="ident">logging</span>.<span class="ident">clone</span>()
    }
}

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="ident">Spirit</span>::<span class="op">&lt;</span><span class="ident">Opts</span>, <span class="ident">Cfg</span><span class="op">&gt;</span>::<span class="ident">new</span>()
        .<span class="ident">with</span>(
            <span class="ident">Pipeline</span>::<span class="ident">new</span>(<span class="string">&quot;logging&quot;</span>).<span class="ident">extract</span>(<span class="op">|</span><span class="ident">opts</span>: <span class="kw-2">&amp;</span><span class="ident">Opts</span>, <span class="ident">cfg</span>: <span class="kw-2">&amp;</span><span class="ident">Cfg</span><span class="op">|</span> <span class="ident">LogBoth</span> {
                <span class="ident">cfg</span>: <span class="ident">cfg</span>.<span class="ident">logging</span>(),
                <span class="ident">opts</span>: <span class="ident">opts</span>.<span class="ident">logging</span>(),
            }),
        )
        .<span class="ident">run</span>(<span class="op">|</span><span class="ident">_spirit</span><span class="op">|</span> {
            <span class="macro">info</span><span class="macro">!</span>(<span class="string">&quot;Hello world&quot;</span>);
            <span class="prelude-val">Ok</span>(())
        });
}</pre></div>
<p>The configuration could look something like this:</p>
<pre><code class="language-toml">[[logging]]
level = &quot;DEBUG&quot;
type = &quot;file&quot;
filename = &quot;/tmp/example.log&quot;
clock = &quot;UTC&quot;
</code></pre>
</div><h2 id='reexports' class='section-header'><a href="#reexports">Re-exports</a></h2>
<table><tr><td><code>pub use background::<a class="struct" href="../spirit_log/background/struct.Background.html" title="struct spirit_log::background::Background">Background</a>;</code></td></tr><tr><td><code>pub use background::<a class="struct" href="../spirit_log/background/struct.FlushGuard.html" title="struct spirit_log::background::FlushGuard">FlushGuard</a>;</code></td></tr><tr><td><code>pub use background::<a class="enum" href="../spirit_log/background/enum.OverflowMode.html" title="enum spirit_log::background::OverflowMode">OverflowMode</a>;</code></td></tr></table><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="background/index.html" title='spirit_log::background mod'>background</a></td><td class='docblock-short'><p>Support for logging in the background.</p>
</td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.Cfg.html" title='spirit_log::Cfg struct'>Cfg</a></td><td class='docblock-short'><p>A configuration fragment to set up logging.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.CfgAndOpts.html" title='spirit_log::CfgAndOpts struct'>CfgAndOpts</a></td><td class='docblock-short'><p>A combination of <a href="../spirit_log/struct.Cfg.html" title="Cfg"><code>Cfg</code></a> and <a href="../spirit_log/struct.Opts.html" title="Opts"><code>Opts</code></a>.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.LogInstaller.html" title='spirit_log::LogInstaller struct'>LogInstaller</a></td><td class='docblock-short'><p>An <a href="../spirit/fragment/trait.Installer.html" title="Installer"><code>Installer</code></a> for the <a href="../fern/builders/struct.Dispatch.html" title="Dispatch"><code>Dispatch</code></a>.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Opts.html" title='spirit_log::Opts struct'>Opts</a></td><td class='docblock-short'><p>A fragment for command line options.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.SyslogError.html" title='spirit_log::SyslogError struct'>SyslogError</a></td><td class='docblock-short'><p>This error can be returned when initialization of logging to syslog fails.</p>
</td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.init.html" title='spirit_log::init fn'>init</a></td><td class='docblock-short'><p>Initialize the global state.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.install.html" title='spirit_log::install fn'>install</a></td><td class='docblock-short'><p>Replace the current logger with the provided one.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.install_parts.html" title='spirit_log::install_parts fn'>install_parts</a></td><td class='docblock-short'><p>Replace the current logger with the provided one.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "spirit_log";</script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>