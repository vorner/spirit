<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `SpiritBuilder` trait in crate `spirit`."><meta name="keywords" content="rust, rustlang, rust-lang, SpiritBuilder"><title>spirit::SpiritBuilder - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../spirit/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Trait SpiritBuilder</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#required-methods">Required Methods</a><div class="sidebar-links"><a href="#tymethod.build">build</a><a href="#tymethod.run">run</a></div><a class="sidebar-title" href="#foreign-impls">Implementations on Foreign Types</a><div class="sidebar-links"><a href="#impl-SpiritBuilder-for-Result%3CBuilder%3CO%2C%20C%3E%2C%20AnyError%3E">Result&lt;Builder&lt;O, C&gt;, AnyError&gt;</a></div><a class="sidebar-title" href="#implementors">Implementors</a></div><p class='location'><a href='index.html'>spirit</a></p><script>window.sidebarCurrent = {name: 'SpiritBuilder', ty: 'trait', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/spirit/spirit.rs.html#916-977' title='goto source code'>[src]</a></span><span class='in-band'>Trait <a href='index.html'>spirit</a>::<wbr><a class="trait" href=''>SpiritBuilder</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><pre class='rust trait'>pub trait SpiritBuilder: <a class="trait" href="../spirit/cfg_loader/trait.ConfigBuilder.html" title="trait spirit::cfg_loader::ConfigBuilder">ConfigBuilder</a> + <a class="trait" href="../spirit/extension/trait.Extensible.html" title="trait spirit::extension::Extensible">Extensible</a> {
    fn <a href='#tymethod.build' class='fnname'>build</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background_thread: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../spirit/app/struct.App.html" title="struct spirit::app::App">App</a>&lt;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Opts" title="type spirit::extension::Extensible::Opts">Opts</a>, Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Config" title="type spirit::extension::Extensible::Config">Config</a>&gt;, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.run' class='fnname'>run</a>&lt;B&gt;(self, body: B)<br>&nbsp;&nbsp;&nbsp; <span class="where">where<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B: <a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(&amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;<a class="struct" href="../spirit/struct.Spirit.html" title="struct spirit::Spirit">Spirit</a>&lt;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Opts" title="type spirit::extension::Extensible::Opts">Opts</a>, Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Config" title="type spirit::extension::Extensible::Config">Config</a>&gt;&gt;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static</span>;
}</pre></div><div class='docblock'><p>An interface to turn the spirit <a href="../spirit/struct.Builder.html" title="Builder"><code>Builder</code></a> into a <a href="../spirit/struct.Spirit.html" title="Spirit"><code>Spirit</code></a> and possibly run it.</p>
<p>It is a trait to support a little trick. The <a href="../spirit/prelude/trait._.html#tymethod.run" title="SpiritBuilder::run"><code>run</code></a> method has the ability
to handle errors by logging them and then terminating the application with a non-zero exit
code. It is convenient to include even the setup errors in this logging.</p>
<p>Therefore, the trait is implemented both on <a href="../spirit/struct.Builder.html" title="Builder"><code>Builder</code></a> and <code>Result&lt;Builder, AnyError&gt;</code> (and the
other traits on <a href="../spirit/struct.Builder.html" title="Builder"><code>Builder</code></a> also support this trick). That way all the errors can be just
transparently gathered and handled uniformly, without any error handling on the user side.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">spirit</span>::{<span class="ident">Empty</span>, <span class="ident">Spirit</span>};
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;

<span class="comment">// This returns Builder</span>
<span class="ident">Spirit</span>::<span class="op">&lt;</span><span class="ident">Empty</span>, <span class="ident">Empty</span><span class="op">&gt;</span>::<span class="ident">new</span>()
    <span class="comment">// This method returns Result&lt;Builder, AnyError&gt;, but we don&#39;t handle the possible error with</span>
    <span class="comment">// ?.</span>
    .<span class="ident">run_before</span>(<span class="op">|</span><span class="kw">_</span><span class="op">|</span> <span class="prelude-val">Ok</span>(()))
    <span class="comment">// The run lives both on Builder and Result&lt;Builder, AnyError&gt;. Here we call the latter.</span>
    <span class="comment">// If we get an error from above, the body here isn&#39;t run at all, but the error is handled</span>
    <span class="comment">// similarly as any errors from within the body.</span>
    .<span class="ident">run</span>(<span class="op">|</span><span class="kw">_</span><span class="op">|</span> <span class="prelude-val">Ok</span>(()))</pre></div>
</div><h2 id='required-methods' class='small-section-header'>Required methods<a href='#required-methods' class='anchor'></a></h2><div class='methods'><h3 id='tymethod.build' class='method'><code>fn <a href='#tymethod.build' class='fnname'>build</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;background_thread: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../spirit/app/struct.App.html" title="struct spirit::app::App">App</a>&lt;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Opts" title="type spirit::extension::Extensible::Opts">Opts</a>, Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Config" title="type spirit::extension::Extensible::Config">Config</a>&gt;, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt;</code></h3><div class='docblock'><p>Finish building the Spirit.</p>
<p>This transitions from the configuration phase of Spirit to actually creating it. This loads
the configuration and executes it for the first time. It launches the background thread for
listening to signals and reloading configuration if the <code>background_thread</code> parameter is
set to true.</p>
<p>This starts listening for signals, loads the configuration for the first time and starts
the background thread.</p>
<p>This version returns the <a href="../spirit/app/struct.App.html" title="App"><code>App</code></a> (or error) and error handling is up to the caller. If you
want spirit to take care of nice error logging (even for your application's top level
errors), use <a href="../spirit/prelude/trait._.html#tymethod.run"><code>run</code></a> instead.</p>
<h1 id="warning" class="section-header"><a href="#warning">Warning</a></h1>
<p>If asked to go to background (when you're using the
<a href="https://crates.io/crates/spirit-daemonize"><code>spirit-daemonize</code></a> crate, this uses <code>fork</code>.
Therefore, start any threads after you call <code>build</code> (or from within <a href="../spirit/prelude/trait._.html#tymethod.run"><code>run</code></a>),
or you'll lose them ‒ only the thread doing fork is preserved across it.</p>
<h1 id="panics" class="section-header"><a href="#panics">Panics</a></h1>
<p>This will panic if <code>background_thread</code> is set to <code>false</code> and there are registered signals.</p>
</div><h3 id='tymethod.run' class='method'><code>fn <a href='#tymethod.run' class='fnname'>run</a>&lt;B&gt;(self, body: B) <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;B: <a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(&amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;<a class="struct" href="../spirit/struct.Spirit.html" title="struct spirit::Spirit">Spirit</a>&lt;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Opts" title="type spirit::extension::Extensible::Opts">Opts</a>, Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Config" title="type spirit::extension::Extensible::Config">Config</a>&gt;&gt;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static,&nbsp;</span></code></h3><div class='docblock'><p>Build the spirit and run the application, handling all relevant errors.</p>
<p>In case an error happens (either when creating the Spirit, or returned by the callback),
the errors are logged (either to the place where logs are sent to in configuration, or to
stderr if the error happens before logging is initialized ‒ for example if configuration
can't be read). The application then terminates with failure exit code.</p>
<p>This mostly just wraps whatever the <a href="../spirit/app/struct.App.html#method.run_term" title="App::run_term"><code>App::run_term</code></a> does, but also handles the errors
that already happened on the <a href="../spirit/struct.Builder.html" title="Builder"><code>Builder</code></a>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">time</span>::<span class="ident">Duration</span>;

<span class="kw">use</span> <span class="ident">spirit</span>::{<span class="ident">Empty</span>, <span class="ident">Spirit</span>};
<span class="kw">use</span> <span class="ident">spirit</span>::<span class="ident">prelude</span>::<span class="kw-2">*</span>;

<span class="ident">Spirit</span>::<span class="op">&lt;</span><span class="ident">Empty</span>, <span class="ident">Empty</span><span class="op">&gt;</span>::<span class="ident">new</span>()
    .<span class="ident">run</span>(<span class="op">|</span><span class="ident">spirit</span><span class="op">|</span> {
        <span class="kw">while</span> <span class="op">!</span><span class="ident">spirit</span>.<span class="ident">is_terminated</span>() {
            <span class="comment">// Some reasonable work here</span>
            <span class="ident">thread</span>::<span class="ident">sleep</span>(<span class="ident">Duration</span>::<span class="ident">from_millis</span>(<span class="number">100</span>));
        }

        <span class="prelude-val">Ok</span>(())
    });</pre></div>
</div></div><span class='loading-content'>Loading content...</span><h2 id='foreign-impls' class='small-section-header'>Implementations on Foreign Types<a href='#foreign-impls' class='anchor'></a></h2><h3 id='impl-SpiritBuilder-for-Result%3CBuilder%3CO%2C%20C%3E%2C%20AnyError%3E' class='impl'><code class='in-band'>impl&lt;O, C&gt; <a class="trait" href="../spirit/prelude/trait._.html" title="trait spirit::prelude::_">SpiritBuilder</a> for <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../spirit/struct.Builder.html" title="struct spirit::Builder">Builder</a>&lt;O, C&gt;, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Config" title="type spirit::extension::Extensible::Config">Config</a>: <a class="trait" href="../serde/de/trait.DeserializeOwned.html" title="trait serde::de::DeserializeOwned">DeserializeOwned</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> + 'static,<br>&nbsp;&nbsp;&nbsp;&nbsp;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Opts" title="type spirit::extension::Extensible::Opts">Opts</a>: <a class="trait" href="../structopt/trait.StructOpt.html" title="trait structopt::StructOpt">StructOpt</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static,&nbsp;</span></code><a href='#impl-SpiritBuilder-for-Result%3CBuilder%3CO%2C%20C%3E%2C%20AnyError%3E' class='anchor'></a><a class='srclink' href='../src/spirit/spirit.rs.html#1094-1114' title='goto source code'>[src]</a></h3><div class='impl-items'><h4 id='method.build' class="method hidden"><code>fn <a href='#method.build' class='fnname'>build</a>(self, background_thread: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../spirit/app/struct.App.html" title="struct spirit::app::App">App</a>&lt;O, C&gt;, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt;</code><a class='srclink' href='../src/spirit/spirit.rs.html#1099-1101' title='goto source code'>[src]</a></h4><h4 id='method.run' class="method hidden"><code>fn <a href='#method.run' class='fnname'>run</a>&lt;B:&nbsp;<a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(&amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;<a class="struct" href="../spirit/struct.Spirit.html" title="struct spirit::Spirit">Spirit</a>&lt;O, C&gt;&gt;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;body: B<br>)</code><a class='srclink' href='../src/spirit/spirit.rs.html#1102-1113' title='goto source code'>[src]</a></h4></div><span class='loading-content'>Loading content...</span><h2 id='implementors' class='small-section-header'>Implementors<a href='#implementors' class='anchor'></a></h2><div class='item-list' id='implementors-list'><h3 id='impl-SpiritBuilder' class='impl'><code class='in-band'>impl&lt;O, C&gt; SpiritBuilder for <a class="struct" href="../spirit/struct.Builder.html" title="struct spirit::Builder">Builder</a>&lt;O, C&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Config" title="type spirit::extension::Extensible::Config">Config</a>: <a class="trait" href="../serde/de/trait.DeserializeOwned.html" title="trait serde::de::DeserializeOwned">DeserializeOwned</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> + 'static,<br>&nbsp;&nbsp;&nbsp;&nbsp;Self::<a class="type" href="../spirit/extension/trait.Extensible.html#associatedtype.Opts" title="type spirit::extension::Extensible::Opts">Opts</a>: <a class="trait" href="../structopt/trait.StructOpt.html" title="trait structopt::StructOpt">StructOpt</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static,&nbsp;</span></code><a href='#impl-SpiritBuilder' class='anchor'></a><a class='srclink' href='../src/spirit/spirit.rs.html#979-1092' title='goto source code'>[src]</a></h3><div class='impl-items'><h4 id='method.build-1' class="method hidden"><code>fn <a href='#method.build-1' class='fnname'>build</a>(self, background_thread: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../spirit/app/struct.App.html" title="struct spirit::app::App">App</a>&lt;O, C&gt;, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt;</code><a class='srclink' href='../src/spirit/spirit.rs.html#984-1087' title='goto source code'>[src]</a></h4><h4 id='method.run-1' class="method hidden"><code>fn <a href='#method.run-1' class='fnname'>run</a>&lt;B:&nbsp;<a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(&amp;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;<a class="struct" href="../spirit/struct.Spirit.html" title="struct spirit::Spirit">Spirit</a>&lt;O, C&gt;&gt;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="type" href="../spirit/error/type.AnyError.html" title="type spirit::error::AnyError">AnyError</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'static&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;body: B<br>)</code><a class='srclink' href='../src/spirit/spirit.rs.html#1089-1091' title='goto source code'>[src]</a></h4></div></div><span class='loading-content'>Loading content...</span><script type="text/javascript" src="../implementors/spirit/trait.SpiritBuilder.js" async></script></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "spirit";</script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>